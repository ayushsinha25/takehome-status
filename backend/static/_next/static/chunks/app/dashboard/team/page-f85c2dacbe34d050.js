(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{16559:(e,s,a)=>{"use strict";a.d(s,{$v:()=>j,EO:()=>m,Lt:()=>i,Rx:()=>g,Zr:()=>f,ck:()=>x,r7:()=>h,tv:()=>c,wd:()=>u});var t=a(95155);a(12115);var r=a(17649),l=a(53999),n=a(97168);function i(e){let{...s}=e;return(0,t.jsx)(r.bL,{"data-slot":"alert-dialog",...s})}function c(e){let{...s}=e;return(0,t.jsx)(r.l9,{"data-slot":"alert-dialog-trigger",...s})}function d(e){let{...s}=e;return(0,t.jsx)(r.ZL,{"data-slot":"alert-dialog-portal",...s})}function o(e){let{className:s,...a}=e;return(0,t.jsx)(r.hJ,{"data-slot":"alert-dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a})}function m(e){let{className:s,...a}=e;return(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{}),(0,t.jsx)(r.UC,{"data-slot":"alert-dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...a})]})}function u(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",s),...a})}function x(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,l.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...a})}function h(e){let{className:s,...a}=e;return(0,t.jsx)(r.hE,{"data-slot":"alert-dialog-title",className:(0,l.cn)("text-lg font-semibold",s),...a})}function j(e){let{className:s,...a}=e;return(0,t.jsx)(r.VY,{"data-slot":"alert-dialog-description",className:(0,l.cn)("text-muted-foreground text-sm",s),...a})}function g(e){let{className:s,...a}=e;return(0,t.jsx)(r.rc,{className:(0,l.cn)((0,n.r)(),s),...a})}function f(e){let{className:s,...a}=e;return(0,t.jsx)(r.ZD,{className:(0,l.cn)((0,n.r)({variant:"outline"}),s),...a})}},29468:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>k});var t=a(95155),r=a(12115),l=a(97168),n=a(88482),i=a(88145),c=a(54011),d=a(53999);function o(e){let{className:s,...a}=e;return(0,t.jsx)(c.bL,{"data-slot":"avatar",className:(0,d.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",s),...a})}function m(e){let{className:s,...a}=e;return(0,t.jsx)(c.H4,{"data-slot":"avatar-fallback",className:(0,d.cn)("bg-muted flex size-full items-center justify-center rounded-full",s),...a})}var u=a(95784),x=a(16559),h=a(76052),j=a(31886),g=a(56671),f=a(75525),p=a(17580),v=a(92657),N=a(14186),b=a(28883),y=a(40646),w=a(54861),_=a(12318),A=a(6824);function k(){var e,s;let{user:a}=(0,h.A)(),[c,d]=(0,r.useState)([]),[k,R]=(0,r.useState)([]),[S,Z]=(0,r.useState)(!0),[q,C]=(0,r.useState)(null),M=null==a||null==(s=a.organizations)||null==(e=s[0])?void 0:e.role,z="admin"===M;(0,r.useEffect)(()=>{E()},[]);let E=async()=>{try{if(Z(!0),z){let e=await j.ZQ.getPendingMemberships();d(e)}let e=[{id:1,email:(null==a?void 0:a.email)||"",username:(null==a?void 0:a.username)||"",full_name:(null==a?void 0:a.full_name)||"",role:M||"member",status:"approved",joined_at:new Date().toISOString()}];R(e)}catch(e){console.error("Failed to load team data:",e),g.toast.error("Failed to load team data")}finally{Z(!1)}},P=async(e,s,a)=>{try{C(e);let t=await j.ZQ.approveMembership(e,s,a);g.toast.success(t.message),d(s=>s.filter(s=>s.id!==e)),E()}catch(e){var t,r;g.toast.error((null==(r=e.response)||null==(t=r.data)?void 0:t.detail)||"Failed to ".concat(s," membership"))}finally{C(null)}},I=e=>{switch(e){case"admin":return(0,t.jsx)(f.A,{className:"h-4 w-4"});case"member":default:return(0,t.jsx)(p.A,{className:"h-4 w-4"});case"viewer":return(0,t.jsx)(v.A,{className:"h-4 w-4"})}},L=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase();return S?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),(0,t.jsx)("p",{children:"Loading team data..."})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Team Management"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Manage your organization's team members and permissions"})]}),z&&c.length>0&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(N.A,{className:"h-5 w-5"}),"Pending Membership Requests",(0,t.jsx)(i.E,{variant:"secondary",children:c.length})]}),(0,t.jsx)(n.BT,{children:"Review and approve new member requests for your organization"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(o,{children:(0,t.jsx)(m,{children:L(e.user.full_name)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.user.full_name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[(0,t.jsx)(b.A,{className:"h-3 w-3"}),e.user.email]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Requested: ",(0,A.GP)(new Date(e.joined_at),"MMM d, yyyy")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Requested Role:"}),(0,t.jsxs)(i.E,{variant:"outline",className:"gap-1",children:[I(e.requested_role),e.requested_role]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(x.Lt,{children:[(0,t.jsx)(x.tv,{asChild:!0,children:(0,t.jsxs)(l.$,{size:"sm",className:"gap-1",disabled:q===e.id,children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),"Approve"]})}),(0,t.jsxs)(x.EO,{children:[(0,t.jsxs)(x.wd,{children:[(0,t.jsx)(x.r7,{children:"Approve Membership"}),(0,t.jsxs)(x.$v,{children:["Approve ",e.user.full_name," to join your organization. You can assign a different role if needed."]})]}),(0,t.jsxs)("div",{className:"my-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Assign Role:"}),(0,t.jsxs)(u.l6,{defaultValue:e.requested_role,children:[(0,t.jsx)(u.bq,{className:"mt-2",children:(0,t.jsx)(u.yv,{})}),(0,t.jsxs)(u.gC,{children:[(0,t.jsx)(u.eb,{value:"admin",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),"Admin - Full access"]})}),(0,t.jsx)(u.eb,{value:"member",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Member - Manage services"]})}),(0,t.jsx)(u.eb,{value:"viewer",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),"Viewer - Read only"]})})]})]})]}),(0,t.jsxs)(x.ck,{children:[(0,t.jsx)(x.Zr,{children:"Cancel"}),(0,t.jsx)(x.Rx,{onClick:()=>P(e.id,"approve",e.requested_role),children:"Approve Membership"})]})]})]}),(0,t.jsxs)(x.Lt,{children:[(0,t.jsx)(x.tv,{asChild:!0,children:(0,t.jsxs)(l.$,{size:"sm",variant:"outline",className:"gap-1",disabled:q===e.id,children:[(0,t.jsx)(w.A,{className:"h-4 w-4"}),"Deny"]})}),(0,t.jsxs)(x.EO,{children:[(0,t.jsxs)(x.wd,{children:[(0,t.jsx)(x.r7,{children:"Deny Membership"}),(0,t.jsxs)(x.$v,{children:["Are you sure you want to deny ",e.user.full_name,"'s membership request? This action cannot be undone."]})]}),(0,t.jsxs)(x.ck,{children:[(0,t.jsx)(x.Zr,{children:"Cancel"}),(0,t.jsx)(x.Rx,{onClick:()=>P(e.id,"deny"),className:"bg-red-600 hover:bg-red-700",children:"Deny Request"})]})]})]})]})]})]},e.id))})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-5 w-5"}),"Team Members",(0,t.jsx)(i.E,{variant:"secondary",children:k.length})]}),(0,t.jsx)(n.BT,{children:"Current members of your organization"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:k.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(o,{children:(0,t.jsx)(m,{children:L(e.full_name)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.full_name}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[(0,t.jsx)(b.A,{className:"h-3 w-3"}),e.email]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["@",e.username]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(i.E,{variant:(e=>{switch(e){case"admin":return"default";case"member":default:return"secondary";case"viewer":return"outline"}})(e.role),className:"gap-1",children:[I(e.role),e.role]}),e.id===(null==a?void 0:a.id)&&(0,t.jsx)(i.E,{variant:"outline",children:"You"})]})]},e.id))})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:"Role Permissions"}),(0,t.jsx)(n.BT,{children:"Understanding different role permissions in your organization"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Admin"})]}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• Manage all services and incidents"}),(0,t.jsx)("li",{children:"• Approve/deny membership requests"}),(0,t.jsx)("li",{children:"• Manage team roles and permissions"}),(0,t.jsx)("li",{children:"• Access organization settings"})]})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(p.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Member"})]}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• Create and manage services"}),(0,t.jsx)("li",{children:"• Report and update incidents"}),(0,t.jsx)("li",{children:"• Schedule maintenance windows"}),(0,t.jsx)("li",{children:"• View team and analytics"})]})]}),(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(v.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"Viewer"})]}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("li",{children:"• View service status"}),(0,t.jsx)("li",{children:"• View incident history"}),(0,t.jsx)("li",{children:"• Access status pages"}),(0,t.jsx)("li",{children:"• Read-only dashboard access"})]})]})]})})]}),z&&0===c.length&&(0,t.jsx)(n.Zp,{children:(0,t.jsxs)(n.Wu,{className:"text-center py-8",children:[(0,t.jsx)(_.A,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No Pending Requests"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"There are no membership requests waiting for approval."}),(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"New requests will appear here when users try to join your organization."})]})})]})}},76052:(e,s,a)=>{"use strict";a.d(s,{A:()=>d,AuthProvider:()=>c,O:()=>o});var t=a(95155),r=a(12115),l=a(31886),n=a(56671);let i=(0,r.createContext)(void 0);function c(e){let{children:s}=e,[c,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{localStorage.getItem("access_token")?u():m(!1)},[]);let u=async()=>{try{let e=await l.ZQ.getCurrentUser();d(e)}catch(s){var e;console.log("Failed to load user, clearing tokens:",null==(e=s.response)?void 0:e.status),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),d(null),"/login"!==window.location.pathname&&"/register"!==window.location.pathname&&Promise.resolve().then(a.bind(a,56671)).then(e=>{let{toast:s}=e;s.error("Your session has expired. Please log in again.")})}finally{m(!1)}},x=async(e,s)=>{try{let a=await l.ZQ.login(e,s);if(a.can_login)localStorage.setItem("access_token",a.access_token),localStorage.setItem("refresh_token",a.refresh_token),d(a.user),n.toast.success("Successfully logged in!");else throw"pending"===a.membership_status?n.toast.error(a.message||"Your membership is pending approval"):"denied"===a.membership_status&&n.toast.error(a.message||"Your membership request was denied"),Error(a.message||"Cannot login at this time")}catch(s){var a,t;let e=(null==(t=s.response)||null==(a=t.data)?void 0:a.detail)||s.message||"Login failed";throw n.toast.error(e),s}},h=async e=>{try{let s=await l.ZQ.register(e);return s.can_login?(localStorage.setItem("access_token",s.access_token),localStorage.setItem("refresh_token",s.refresh_token),d(s.user),n.toast.success(s.message||"Registration successful!")):n.toast.success(s.message||"Registration submitted for approval"),s}catch(t){var s,a;let e=(null==(a=t.response)||null==(s=a.data)?void 0:s.detail)||"Registration failed";throw n.toast.error(e),t}},j=async()=>{try{await l.ZQ.logout()}catch(e){}finally{d(null),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),n.toast.success("Logged out successfully")}};return(0,t.jsx)(i.Provider,{value:{user:c,loading:o,login:x,register:h,logout:j},children:s})}function d(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function o(e){let{children:s}=e,{user:a,loading:r}=d();return r?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):a?(0,t.jsx)(t.Fragment,{children:s}):(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Authentication Required"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Please log in to access this page."}),(0,t.jsx)("a",{href:"/login",className:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:"Go to Login"})]})})}},93441:(e,s,a)=>{Promise.resolve().then(a.bind(a,29468))}},e=>{e.O(0,[464,671,455,171,360,513,567,129,441,964,358],()=>e(e.s=93441)),_N_E=e.O()}]);