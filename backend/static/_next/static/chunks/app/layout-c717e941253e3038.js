(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{19324:()=>{},28589:(e,t,a)=>{Promise.resolve().then(a.bind(a,76052)),Promise.resolve().then(a.t.bind(a,29840,23)),Promise.resolve().then(a.t.bind(a,19324,23)),Promise.resolve().then(a.bind(a,56671))},29840:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},31886:(e,t,a)=>{"use strict";a.d(t,{Ev:()=>c,FH:()=>r,TZ:()=>l,XU:()=>i,ZQ:()=>n,uZ:()=>d});var s=a(23464);let o=a(49509).env.NEXT_PUBLIC_API_URL||window.location.origin;console.log("API_BASE_URL:",o);let r=s.A.create({baseURL:"".concat(o,"/api/v1"),headers:{"Content-Type":"application/json"},timeout:1e4});r.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>{var t;let s=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!s._retry){s._retry=!0;try{let e=localStorage.getItem("refresh_token");if(e){let{access_token:t}=(await r.post("/auth/refresh",{refresh_token:e})).data;return localStorage.setItem("access_token",t),s.headers.Authorization="Bearer ".concat(t),r(s)}}catch(e){console.log("Token refresh failed:",e),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),a.e(671).then(a.bind(a,56671)).then(e=>{let{toast:t}=e;t.error("Your session has expired. Please log in again.")}),window.location.pathname.includes("/login")||setTimeout(()=>{window.location.href="/login"},1e3)}}return Promise.reject(e)});let n={login:async(e,t)=>{try{console.log("Attempting login with:",{email:e,baseURL:r.defaults.baseURL});let a=await r.post("/auth/login",{email:e,password:t});return console.log("Login response:",a.status,a.data),a.data}catch(e){var a,s;throw console.error("Login error details:",{message:e.message,status:null==(a=e.response)?void 0:a.status,data:null==(s=e.response)?void 0:s.data,config:e.config}),e}},register:async e=>{try{console.log("Attempting register with:",{...e,password:"[HIDDEN]",baseURL:r.defaults.baseURL});let t=await r.post("/auth/register",e);return console.log("Register response:",t.status,t.data),t.data}catch(e){var t,a;throw console.error("Register error details:",{message:e.message,status:null==(t=e.response)?void 0:t.status,data:null==(a=e.response)?void 0:a.data,config:e.config}),e}},getOrganizations:async()=>(await r.get("/auth/organizations")).data,getPendingMemberships:async()=>(await r.get("/auth/pending-memberships")).data,approveMembership:async(e,t,a)=>(await r.post("/auth/approve-membership",{membership_id:e,action:t,role:a})).data,getCurrentUser:async()=>(await r.get("/auth/me")).data,logout:async()=>{await r.post("/auth/logout"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}},i={getAll:async()=>(await r.get("/services/")).data,create:async e=>(await r.post("/services/",e)).data,update:async(e,t)=>(await r.put("/services/".concat(e),t)).data,updateStatus:async(e,t,a)=>(await r.patch("/services/".concat(e,"/status"),{status:t,reason:a})).data,delete:async e=>{await r.delete("/services/".concat(e))},getHistory:async e=>(await r.get("/services/".concat(e,"/history"))).data},c={getAll:async()=>(await r.get("/incidents/")).data,create:async e=>(await r.post("/incidents/",e)).data,update:async(e,t)=>(await r.put("/incidents/".concat(e),t)).data,addUpdate:async(e,t)=>(await r.post("/incidents/".concat(e,"/updates"),t)).data,delete:async e=>{await r.delete("/incidents/".concat(e))}},l={getPublicStatus:async e=>(await s.A.get("".concat(o,"/api/v1/status/").concat(e))).data,getStatusHistory:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return(await s.A.get("".concat(o,"/api/v1/status/").concat(e,"/history?days=").concat(t))).data},getPublicIncidents:async e=>(await s.A.get("".concat(o,"/api/v1/status/").concat(e,"/incidents"))).data},d={getUptimeMetrics:async e=>(await r.get("/metrics/uptime/".concat(e))).data}},76052:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,AuthProvider:()=>c,O:()=>d});var s=a(95155),o=a(12115),r=a(31886),n=a(56671);let i=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[c,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0);(0,o.useEffect)(()=>{localStorage.getItem("access_token")?g():u(!1)},[]);let g=async()=>{try{let e=await r.ZQ.getCurrentUser();l(e)}catch(t){var e;console.log("Failed to load user, clearing tokens:",null==(e=t.response)?void 0:e.status),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),l(null),"/login"!==window.location.pathname&&"/register"!==window.location.pathname&&Promise.resolve().then(a.bind(a,56671)).then(e=>{let{toast:t}=e;t.error("Your session has expired. Please log in again.")})}finally{u(!1)}},m=async(e,t)=>{try{let a=await r.ZQ.login(e,t);if(a.can_login)localStorage.setItem("access_token",a.access_token),localStorage.setItem("refresh_token",a.refresh_token),l(a.user),n.toast.success("Successfully logged in!");else throw"pending"===a.membership_status?n.toast.error(a.message||"Your membership is pending approval"):"denied"===a.membership_status&&n.toast.error(a.message||"Your membership request was denied"),Error(a.message||"Cannot login at this time")}catch(t){var a,s;let e=(null==(s=t.response)||null==(a=s.data)?void 0:a.detail)||t.message||"Login failed";throw n.toast.error(e),t}},h=async e=>{try{let t=await r.ZQ.register(e);return t.can_login?(localStorage.setItem("access_token",t.access_token),localStorage.setItem("refresh_token",t.refresh_token),l(t.user),n.toast.success(t.message||"Registration successful!")):n.toast.success(t.message||"Registration submitted for approval"),t}catch(s){var t,a;let e=(null==(a=s.response)||null==(t=a.data)?void 0:t.detail)||"Registration failed";throw n.toast.error(e),s}},p=async()=>{try{await r.ZQ.logout()}catch(e){}finally{l(null),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),n.toast.success("Logged out successfully")}};return(0,s.jsx)(i.Provider,{value:{user:c,loading:d,login:m,register:h,logout:p},children:t})}function l(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:t}=e,{user:a,loading:o}=l();return o?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):a?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Authentication Required"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Please log in to access this page."}),(0,s.jsx)("a",{href:"/login",className:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:"Go to Login"})]})})}}},e=>{e.O(0,[385,464,671,441,964,358],()=>e(e.s=28589)),_N_E=e.O()}]);